function[M,G] = get_matrix_minus(type, q)

%**************************************************************************
%
%   [M,G] = get_matrix_minus(q)
%
%       M : 慣性行列
%       H : 遠心力・コリオリ力ベクトル
%       G : 重力ベクトル
%
%                                                       20.03.16 by OKB
%**************************************************************************

% %%
% clear
% q = [0; pi/2; 0; 0];
% dq = zeros(4,1);
%%%%%%%%%%%%%%%%%%%%%%%%%%%%

param = get_parameter(type);
l = param.l;
lg = param.lg;
m = param.M;
It = param.I;

% [type,Link,Sigma, l,lg,m,It, Tlim,dqlim, coulomb,viscous] = get_paramater();
g = 9.8;

switch type
    
    case '3d_RRRR'
        % 空間4リンク　Z-Y-Z-Y
        M = [ It(1) + It(2) + It(3) + It(4) + (m(4)*(2*(sin(q(1))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4))) + lg(4)*cos(q(1))*sin(q(3))*sin(q(4)))^2 + 2*(cos(q(1))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4))) - lg(4)*sin(q(1))*sin(q(3))*sin(q(4)))^2))/2 - (lg(2)^2*m(2)*(4*cos(q(2))^2 - 4))/4 + m(3)*sin(q(2))^2*(l(2) + lg(3))^2,                                                                                                                                                                                                                                                                                                                                                             It(2) + It(3) + It(4) + lg(4)^2*m(4)*cos(q(3))*sin(q(2))*sin(q(3)) - lg(4)^2*m(4)*cos(q(2))*cos(q(4))*sin(q(3))*sin(q(4)) - l(2)*lg(4)*m(4)*cos(q(2))*sin(q(3))*sin(q(4)) - l(3)*lg(4)*m(4)*cos(q(2))*sin(q(3))*sin(q(4)) - lg(4)^2*m(4)*cos(q(3))*cos(q(4))^2*sin(q(2))*sin(q(3)),                                                                                                                                                                                                                                                                                                                                                                                                 It(3) + It(4) + lg(4)*m(4)*sin(q(4))*(l(2)*cos(q(3))*sin(q(2)) + l(3)*cos(q(3))*sin(q(2)) + lg(4)*cos(q(2))*sin(q(4)) + lg(4)*cos(q(3))*cos(q(4))*sin(q(2))),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                       It(4) + lg(4)^2*m(4)*sin(q(2))*sin(q(3)) + l(2)*lg(4)*m(4)*cos(q(4))*sin(q(2))*sin(q(3)) + l(3)*lg(4)*m(4)*cos(q(4))*sin(q(2))*sin(q(3)) ;
              It(2) + It(3) + It(4) + lg(4)^2*m(4)*cos(q(3))*sin(q(2))*sin(q(3)) - lg(4)^2*m(4)*cos(q(2))*cos(q(4))*sin(q(3))*sin(q(4)) - l(2)*lg(4)*m(4)*cos(q(2))*sin(q(3))*sin(q(4)) - l(3)*lg(4)*m(4)*cos(q(2))*sin(q(3))*sin(q(4)) - lg(4)^2*m(4)*cos(q(3))*cos(q(4))^2*sin(q(2))*sin(q(3)),                                                                                                                                                                                                                                                                                                                   It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + (lg(4)^2*m(4))/2 + 2*l(2)*l(3)*m(4) + 2*l(2)*lg(3)*m(3) + (cos(2*q(3))*lg(4)^2*m(4))/2 + (lg(4)^2*m(4)*cos(q(4))^2)/2 - (cos(2*q(3))*lg(4)^2*m(4)*cos(q(4))^2)/2 + 2*l(2)*lg(4)*m(4)*cos(q(4)) + 2*l(3)*lg(4)*m(4)*cos(q(4)), It(3) + It(4) - (m(4)*(2*cos(q(1))*(lg(4)*cos(q(3))*sin(q(1))*sin(q(4)) + lg(4)*cos(q(1))*cos(q(2))*sin(q(3))*sin(q(4)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) - 2*sin(q(1))*(lg(4)*cos(q(1))*cos(q(3))*sin(q(4)) - lg(4)*cos(q(2))*sin(q(1))*sin(q(3))*sin(q(4)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) + 2*lg(4)*sin(q(2))*sin(q(3))*sin(q(4))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4)))))/2, It(4) - (m(4)*(2*cos(q(1))*(cos(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) + lg(4)*cos(q(4))*sin(q(1))*sin(q(3)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) - 2*(lg(4)*cos(q(2))*sin(q(4)) + lg(4)*cos(q(3))*cos(q(4))*sin(q(2)))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4))) + 2*sin(q(1))*(sin(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) - lg(4)*cos(q(1))*cos(q(4))*sin(q(3)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4)))))/2 ;
              It(3) + It(4) + lg(4)*m(4)*sin(q(4))*(l(2)*cos(q(3))*sin(q(2)) + l(3)*cos(q(3))*sin(q(2)) + lg(4)*cos(q(2))*sin(q(4)) + lg(4)*cos(q(3))*cos(q(4))*sin(q(2))),                                                                                   It(3) + It(4) - (m(4)*(2*cos(q(1))*(lg(4)*cos(q(3))*sin(q(1))*sin(q(4)) + lg(4)*cos(q(1))*cos(q(2))*sin(q(3))*sin(q(4)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) - 2*sin(q(1))*(lg(4)*cos(q(1))*cos(q(3))*sin(q(4)) - lg(4)*cos(q(2))*sin(q(1))*sin(q(3))*sin(q(4)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) + 2*lg(4)*sin(q(2))*sin(q(3))*sin(q(4))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4)))))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                              It(3) + It(4) + (lg(4)^2*m(4))/2 - (cos(2*q(4))*lg(4)^2*m(4))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                          It(4) ;
              It(4) + lg(4)^2*m(4)*sin(q(2))*sin(q(3)) + l(2)*lg(4)*m(4)*cos(q(4))*sin(q(2))*sin(q(3)) + l(3)*lg(4)*m(4)*cos(q(4))*sin(q(2))*sin(q(3)), It(4) - (m(4)*(2*cos(q(1))*(cos(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) + lg(4)*cos(q(4))*sin(q(1))*sin(q(3)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4))) - 2*(lg(4)*cos(q(2))*sin(q(4)) + lg(4)*cos(q(3))*cos(q(4))*sin(q(2)))*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4))) + 2*sin(q(1))*(sin(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) - lg(4)*cos(q(1))*cos(q(4))*sin(q(3)))*(cos(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*cos(q(2)) - lg(4)*cos(q(3))*sin(q(2))*sin(q(4)))))/2,                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                        It(4),                                                                                                                                                                                                                                                                                                   It(4) + (m(4)*(2*(cos(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) + lg(4)*cos(q(4))*sin(q(1))*sin(q(3)))^2 + 2*(sin(q(1))*(lg(4)*sin(q(2))*sin(q(4)) - lg(4)*cos(q(2))*cos(q(3))*cos(q(4))) - lg(4)*cos(q(1))*cos(q(4))*sin(q(3)))^2 + 2*(lg(4)*cos(q(2))*sin(q(4)) + lg(4)*cos(q(3))*cos(q(4))*sin(q(2)))^2))/2 ];

        g = -9.8;
        G = [ 0 ;
              -g*m(4)*(sin(q(2))*(l(3) + lg(4)*cos(q(4))) + l(2)*sin(q(2)) + lg(4)*cos(q(2))*cos(q(3))*sin(q(4))) - g*m(3)*(l(2)*sin(q(2)) + lg(3)*sin(q(2))) - g*lg(2)*m(2)*sin(q(2)) ;
               g*lg(4)*m(4)*sin(q(2))*sin(q(3))*sin(q(4)) ;
              -g*lg(4)*m(4)*(cos(q(2))*sin(q(4)) + cos(q(3))*cos(q(4))*sin(q(2))) ];




    case '3d_PRRR'
        % 直動スライダ空間4リンク
        M = [ It(1) + It(2) + It(3) + It(4) + m(1) + m(2) + m(3) + m(4), It(2) + It(3) + It(4) + m(4)*sin(q(2))*(lg(4)*sin(q(3) + q(4)) + l(3)*sin(q(3))) + lg(3)*m(3)*sin(q(2))*sin(q(3)), It(3) + It(4) - m(4)*cos(q(2))*(lg(4)*cos(q(3) + q(4)) + l(3)*cos(q(3))) - lg(3)*m(3)*cos(q(2))*cos(q(3)),    It(4) - lg(4)*m(4)*cos(q(3) + q(4))*cos(q(2)) ;
              It(2) + It(3) + It(4) + m(4)*sin(q(2))*(lg(4)*sin(q(3) + q(4)) + l(3)*sin(q(3))) + lg(3)*m(3)*sin(q(2))*sin(q(3)),               It(2) + It(3) + It(4) + m(4)*(lg(4)*sin(q(3) + q(4)) + l(3)*sin(q(3)))^2 + lg(3)^2*m(3)*sin(q(3))^2,                                                                                             It(3) + It(4),                                            It(4) ;
              It(3) + It(4) - m(4)*cos(q(2))*(lg(4)*cos(q(3) + q(4)) + l(3)*cos(q(3))) - lg(3)*m(3)*cos(q(2))*cos(q(3)),                                                                                                     It(3) + It(4),                   It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + 2*l(3)*lg(4)*m(4)*cos(q(4)), It(4) + lg(4)^2*m(4) + l(3)*lg(4)*m(4)*cos(q(4)) ;
              It(4) - lg(4)*m(4)*cos(q(3) + q(4))*cos(q(2)),                                                                                                             It(4),                                                          It(4) + lg(4)^2*m(4) + l(3)*lg(4)*m(4)*cos(q(4)),                             It(4) + lg(4)^2*m(4) ];

        G = [ 0 ;
              0 ;
              - g*m(4)*(lg(4)*sin(q(3) + q(4)) + l(3)*sin(q(3))) - g*lg(3)*m(3)*sin(q(3)) ;
              -g*lg(4)*m(4)*sin(q(3) + q(4)) ];






    case '2d_RRR'
        % 平面3リンク
        M = [ It(1) + It(2) + It(3) + l(1)^2*m(2) + l(1)^2*m(3) + l(2)^2*m(3) + lg(1)^2*m(1) + lg(2)^2*m(2) + lg(3)^2*m(3) + 2*l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + 2*l(1)*l(2)*m(3)*cos(q(2)) + 2*l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)), It(2) + It(3) + l(2)^2*m(3) + lg(2)^2*m(2) + lg(3)^2*m(3) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)), It(3) + lg(3)^2*m(3) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) ;
              It(2) + It(3) + l(2)^2*m(3) + lg(2)^2*m(2) + lg(3)^2*m(3) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)),                                                                                           It(2) + It(3) + l(2)^2*m(3) + lg(2)^2*m(2) + lg(3)^2*m(3) + 2*l(2)*lg(3)*m(3)*cos(q(3)),                                    It(3) + lg(3)^2*m(3) + l(2)*lg(3)*m(3)*cos(q(3)) ;
              It(3) + lg(3)^2*m(3) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(2)*lg(3)*m(3)*cos(q(3)),                                                                                                                                  It(3) + lg(3)^2*m(3) + l(2)*lg(3)*m(3)*cos(q(3)),                                                                It(3) + lg(3)^2*m(3) ];

        G = [ 0; 0; 0 ];






    case '2d_RRRR'
        % 平面4リンク
        M = [ It(1) + It(2) + It(3) + It(4) + l(1)^2*m(2) + l(1)^2*m(3) + l(1)^2*m(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(1)^2*m(1) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + 2*l(1)*l(3)*m(4)*cos(q(2) + q(3)) + 2*l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + 2*l(1)*l(2)*m(3)*cos(q(2)) + 2*l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + 2*l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)) + 2*cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4), It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4), It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4), It(4) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4) ;
              It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4),                                                                                                                                                                                                  It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + 2*l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)),                                                                                                                It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)),                                           It(4) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(3)*lg(4)*m(4)*cos(q(4)) ;
              It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4),                                                                                                                                                                                                                                                           It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(3)*lg(4)*m(4)*cos(q(4)),                                                                                                                                                                                                          It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + 2*l(3)*lg(4)*m(4)*cos(q(4)),                                                                              It(4) + lg(4)^2*m(4) + l(3)*lg(4)*m(4)*cos(q(4)) ;
              It(4) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(3)*lg(4)*m(4)*cos(q(4)) + cos(q(2) + q(3) + q(4))*l(1)*lg(4)*m(4),                                                                                                                                                                                                                                                                                                                                                         It(4) + lg(4)^2*m(4) + l(2)*lg(4)*m(4)*cos(q(3) + q(4)) + l(3)*lg(4)*m(4)*cos(q(4)),                                                                                                                                                                                                                                                 It(4) + lg(4)^2*m(4) + l(3)*lg(4)*m(4)*cos(q(4)),                                                                                                          It(4) + lg(4)^2*m(4) ];

        G = [ 0; 0; 0; 0 ];





    case '2d_RRRP'
        % 平面4関節　直動（0-0-0-=<）
        M = [ It(1) + It(2) + It(3) + It(4) + l(1)^2*m(2) + l(1)^2*m(3) + l(1)^2*m(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(1)^2*m(1) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + 2*l(1)*l(3)*m(4)*cos(q(2) + q(3)) + 2*l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + 2*l(1)*lg(4)*m(4)*cos(q(2) + q(3)) + 2*l(1)*m(4)*q(4)*cos(q(2) + q(3)) + 2*l(1)*l(2)*m(3)*cos(q(2)) + 2*l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + 2*l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3)) + 2*l(2)*m(4)*q(4)*cos(q(3)), It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*lg(4)*m(4)*cos(q(2) + q(3)) + l(1)*m(4)*q(4)*cos(q(2) + q(3)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3)) + 2*l(2)*m(4)*q(4)*cos(q(3)), It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*lg(4)*m(4)*cos(q(2) + q(3)) + l(1)*m(4)*q(4)*cos(q(2) + q(3)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + l(2)*lg(4)*m(4)*cos(q(3)) + l(2)*m(4)*q(4)*cos(q(3)), It(4) + l(2)*m(4)*sin(q(3)) + l(1)*m(4)*sin(q(2) + q(3));
              It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*lg(4)*m(4)*cos(q(2) + q(3)) + l(1)*m(4)*q(4)*cos(q(2) + q(3)) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*l(2)*m(4)*cos(q(2)) + 2*l(2)*l(3)*m(4)*cos(q(3)) + l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3)) + 2*l(2)*m(4)*q(4)*cos(q(3)),                                                                                                                                                                                                                             It(2) + It(3) + It(4) + l(2)^2*m(3) + l(2)^2*m(4) + l(3)^2*m(4) + lg(2)^2*m(2) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + 2*l(2)*l(3)*m(4)*cos(q(3)) + 2*l(2)*lg(3)*m(3)*cos(q(3)) + 2*l(2)*lg(4)*m(4)*cos(q(3)) + 2*l(2)*m(4)*q(4)*cos(q(3)),                                                                                                                                           It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + l(2)*lg(4)*m(4)*cos(q(3)) + l(2)*m(4)*q(4)*cos(q(3)),                              It(4) + l(2)*m(4)*sin(q(3));
              It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(1)*l(3)*m(4)*cos(q(2) + q(3)) + l(1)*lg(3)*m(3)*cos(q(2) + q(3)) + l(1)*lg(4)*m(4)*cos(q(2) + q(3)) + l(1)*m(4)*q(4)*cos(q(2) + q(3)) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + l(2)*lg(4)*m(4)*cos(q(3)) + l(2)*m(4)*q(4)*cos(q(3)),                                                                                                                                                                                                                                                                                        It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4) + l(2)*l(3)*m(4)*cos(q(3)) + l(2)*lg(3)*m(3)*cos(q(3)) + l(2)*lg(4)*m(4)*cos(q(3)) + l(2)*m(4)*q(4)*cos(q(3)),                                                                                                                                                                                                                                                         It(3) + It(4) + l(3)^2*m(4) + lg(3)^2*m(3) + lg(4)^2*m(4) + m(4)*q(4)^2 + 2*l(3)*lg(4)*m(4) + 2*l(3)*m(4)*q(4) + 2*lg(4)*m(4)*q(4),                                                    It(4);
              It(4) + l(2)*m(4)*sin(q(3)) + l(1)*m(4)*sin(q(2) + q(3)),                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                             It(4) + l(2)*m(4)*sin(q(3)),                                                                                                                                                                                                                                                                                                                                                                                      It(4),                                             It(4) + m(4)];

        G = [ 0; 0; 0; 0 ];



    case '2d_RRP'
        % 平面3関節　直動（ 0-0-=< ）
        M = [ It(1) + It(2) + It(3) + l(1)^2*m(2) + l(1)^2*m(3) + l(2)^2*m(3) + lg(1)^2*m(1) + lg(2)^2*m(2) + lg(3)^2*m(3) + m(3)*q(3)^2 + 2*l(2)*lg(3)*m(3) + 2*l(2)*m(3)*q(3) + 2*lg(3)*m(3)*q(3) + 2*l(1)*l(2)*m(3)*cos(q(2)) + 2*l(1)*lg(2)*m(2)*cos(q(2)) + 2*l(1)*lg(3)*m(3)*cos(q(2)) + 2*l(1)*m(3)*q(3)*cos(q(2)), It(2) + It(3) + l(2)^2*m(3) + lg(2)^2*m(2) + lg(3)^2*m(3) + m(3)*q(3)^2 + 2*l(2)*lg(3)*m(3) + 2*l(2)*m(3)*q(3) + 2*lg(3)*m(3)*q(3) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*lg(2)*m(2)*cos(q(2)) + l(1)*lg(3)*m(3)*cos(q(2)) + l(1)*m(3)*q(3)*cos(q(2)), It(3) + l(1)*m(3)*sin(q(2)) ;
              It(2) + It(3) + l(2)^2*m(3) + lg(2)^2*m(2) + lg(3)^2*m(3) + m(3)*q(3)^2 + 2*l(2)*lg(3)*m(3) + 2*l(2)*m(3)*q(3) + 2*lg(3)*m(3)*q(3) + l(1)*l(2)*m(3)*cos(q(2)) + l(1)*lg(2)*m(2)*cos(q(2)) + l(1)*lg(3)*m(3)*cos(q(2)) + l(1)*m(3)*q(3)*cos(q(2)),                                                                                                                                                                                      It(2) + It(3) + lg(2)^2*m(2) + m(3)*(l(2) + lg(3) + q(3))^2,                       It(3) ;
              It(3) + l(1)*m(3)*sin(q(2)),                                                                                                                                                                                                                                            It(3),                It(3) + m(3) ];

        G = [ 0; 0; 0 ];


    otherwise
        error('error get_matrix')
        
end

end
